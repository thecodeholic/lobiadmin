<!--Author      : @arboshiki-->
<div id="image-cropping">
    <h2 class="page-header-dashed">Jcrop</h2>
    <div id="jcrop-demo-tab" role="tabpanel">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a href="#jcrop-demo-tab .styling" role="tab" data-toggle="tab">Styling</a></li>
            <li role="presentation"><a href="#jcrop-demo-tab .basic-setup" role="tab" data-toggle="tab">Basic example</a></li>
            <li role="presentation"><a href="#jcrop-demo-tab .basic-handler" role="tab" data-toggle="tab">Basic Handler</a></li>
            <li role="presentation"><a href="#jcrop-demo-tab .aspect-ratio" role="tab" data-toggle="tab">Aspect Ratio</a></li>
            <li role="presentation"><a href="#jcrop-demo-tab .animation-transitions" role="tab" data-toggle="tab">Animations</a></li>
            <li role="presentation"><a href="#jcrop-demo-tab .api-demo" role="tab" data-toggle="tab">API Demo</a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content bg-white padding-15">
            <div role="tabpanel" class="tab-pane active styling clearfix">
                <h4>Manipulate classes</h4>
                <div class="pull-left">
                    <img src="img/demo/1_680.jpg" class="styling-img" alt="[Jcrop Example]"/>
                </div>
                <div class="pull-left padding-15">
                    <fieldset>
                        <div class="btn-group" id="buttonbar">
                            <button id="radio1" data-setclass="jcrop-light" class="btn btn-default active" >jcrop-light</button>
                            <button id="radio2" data-setclass="jcrop-dark" class="btn btn-default" >jcrop-dark</button>
                            <button id="radio3" data-setclass="jcrop-normal" class="btn btn-default" >normal</button>
                        </div>
                    </fieldset>
                </div>
            </div>
            <div role="tabpanel" class="tab-pane basic-setup">
                <div class="callout callout-info">
                    <p>
                        <b>This example demonstrates the default behavior of Jcrop.</b>
                        Since no event handlers have been attached it only performs the cropping behavior.
                    </p>
                </div>
                <img src="img/demo/2_680.jpg" alt="[Jcrop Example]"/>
            </div>
            <div role="tabpanel" class="tab-pane basic-handler clearfix">
                <div class="callout callout-info">
                    <p>
                        <b>An example with a basic event handler.</b> Here we've 
                        tied several form values together with a simple event handler invocation. 
                        The result is that the form values are updated in real-time as the selection is changed using Jcrop's onChange handler.
                        That's how easily Jcrop can be integrated into a traditional web form!
                    </p>
                </div>
                <div class="pull-left">
                    <img src="img/demo/3_680.jpg" alt="[Jcrop Example]"/>
                </div>
                <form class="coords">
                    <div class="inline-labels">
                        <label>X1 <input type="text" size="4" id="x1" name="x1" /></label>
                        <label>Y1 <input type="text" size="4" id="y1" name="y1" /></label>
                        <label>X2 <input type="text" size="4" id="x2" name="x2" /></label>
                        <label>Y2 <input type="text" size="4" id="y2" name="y2" /></label>
                        <label>W <input type="text" size="4" id="w" name="w" /></label>
                        <label>H <input type="text" size="4" id="h" name="h" /></label>
                    </div>
                </form>
            </div>
            <div role="tabpanel" class="tab-pane aspect-ratio clearfix">
                <div class="callout callout-info">
                    <p><b>An example implementing a preview pane.</b> Obviously the most visual demo, the preview pane is accomplished entirely outside 
                        of Jcrop with a simple jQuery-flavored callback. This type of interface could be useful for creating a thumbnail or avatar. 
                        The onChange event handler is used to update the view in the preview pane.</p>
                </div>
                <div class="pull-left">
                    <img src="img/demo/4_680.jpg" class="aspect-ratio-img" alt="[Jcrop Example]"/>
                </div>
                <div id="preview-pane">
                    <div class="preview-container">
                        <img src="img/demo/4_680.jpg" class="jcrop-preview" alt="Preview" />
                    </div>
                </div>
            </div>
            <div role="tabpanel" class="tab-pane animation-transitions clearfix">
                <div class="callout callout-info">
                    <p><b>Animation/Transitions.</b> Demonstration of animateTo API method and transitions for bgColor and bgOpacity options. Color fading requires inclusion of John Resig's jQuery Color Animations plugin. If it is not included, colors will not fade.</p>
                </div>
                <div class="pull-left">
                    <img src="img/demo/5_680.jpg" class="animation-transitions-img" alt="Preview" />
                </div>
                <div class="pull-left padding-15">
                    <div id="interface">
                        <label class="checkbox lobicheck lobicheck-info">
                            <input type="checkbox" id="fadetog"> 
                            <i></i> Enable fading (bgFade: true)
                        </label>
                        <label class="checkbox lobicheck lobicheck-info">
                            <input type="checkbox" id="shadetog"> 
                            <i></i> Use experimental shader (shade: true)
                        </label>
                    </div>
                </div>
            </div>
            <div role="tabpanel" class="tab-pane api-demo clearfix">
                <div class="pull-left">
                    <img src="img/demo/8_680.jpg" class="api-img" alt="Preview" />
                </div>
                <div class="pull-left padding-15">
                    <div>
                        <span class="requiresjcrop">
                            <button id="setSelect" class="btn btn-sm btn-default btn-pretty">setSelect</button>
                            <button id="animateTo" class="btn btn-sm btn-default btn-pretty">animateTo</button>
                            <button id="release" class="btn btn-sm btn-default btn-pretty">Release</button>
                            <button id="disable" class="btn btn-sm btn-default btn-pretty">Disable</button>
                        </span>
                        <button id="enable" class="btn btn-sm btn-default btn-pretty" style="display:none;">Re-Enable</button>
                        <button id="unhook" class="btn btn-sm btn-default btn-pretty">Destroy!</button>
                        <button id="rehook" class="btn btn-sm btn-default btn-pretty" style="display:none;">Attach Jcrop</button>
                    </div>

                    <fieldset class="optdual requiresjcrop">
                        <legend>Option Toggles</legend>
                        <div class="optlist offset">
                            <label class="checkbox lobicheck lobicheck-inversed lobicheck-info">
                                <input type="checkbox" id="ar_lock"> 
                                <i></i> Aspect ratio
                            </label>
                            <label class="checkbox lobicheck lobicheck-inversed lobicheck-info">
                                <input type="checkbox" id="size_lock"> 
                                <i></i> minSize/maxSize setting
                            </label>
                        </div>
                        <div class="optlist">
                            <label class="checkbox lobicheck lobicheck-inversed lobicheck-info">
                                <input type="checkbox" id="can_click"> 
                                <i></i> Allow new selections
                            </label>
                            <label class="checkbox lobicheck lobicheck-inversed lobicheck-info">
                                <input type="checkbox" id="can_move"> 
                                <i></i> Selection can be moved
                            </label>
                            <label class="checkbox lobicheck lobicheck-inversed lobicheck-info">
                                <input type="checkbox" id="can_size"> 
                                <i></i> Resizable selection
                            </label>
                        </div>
                    </fieldset>

                    <fieldset class="requiresjcrop" style="margin: .5em 0;">
                        <legend>Change Image</legend>
                        <div class="btn-group btn-group-info">
                            <button class="btn" id="img2">Pool</button>
                            <button class="btn active" id="img1">Sago</button>
                            <button class="btn" id="img3">Sago w/ outerImage</button>
                        </div>
                    </fieldset>

                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        LobiAdmin.loadScript([
            'js/plugin/jcrop/jquery.Jcrop.min.js',
            'js/plugin/jcrop/jquery.color.js'
        ], initPage);
        
        function initPage(){
//             $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
//                e.target // newly activated tab
//                e.relatedTarget // previous active tab
//            });
//            $('#jcrop-demo-tab').on('show.bs.tab', function(){
//                window.console.log("show tab");
//            });
            $('#jcrop-demo-tab .basic-setup>img').Jcrop();
            (function(){
                var api;

                $('#jcrop-demo-tab .styling .styling-img').Jcrop({
                    // start off with jcrop-light class
                    bgOpacity: 0.5,
                    bgColor: 'white',
                    addClass: 'jcrop-light'
                }, function () {
                    api = this;
                    api.setSelect([130, 65, 130 + 350, 65 + 285]);
                    api.setOptions({bgFade: true});
                    api.ui.selection.addClass('jcrop-selection');
                });

                $('#buttonbar').on('click', 'button', function (e) {
                    var $t = $(this), $g = $t.closest('.btn-group');
                    $g.find('button.active').removeClass('active');
                    $t.addClass('active');
                    $g.find('[data-setclass]').each(function () {
                        var $th = $(this), c = $th.data('setclass'),
                                a = $th.hasClass('active');
                        if (a) {
                            api.ui.holder.addClass(c);
                            switch (c) {

                                case 'jcrop-light':
                                    api.setOptions({bgColor: 'white', bgOpacity: 0.5});
                                    break;

                                case 'jcrop-dark':
                                    api.setOptions({bgColor: 'black', bgOpacity: 0.4});
                                    break;

                                case 'jcrop-normal':
                                    api.setOptions({
                                        bgColor: $.Jcrop.defaults.bgColor,
                                        bgOpacity: $.Jcrop.defaults.bgOpacity
                                    });
                                    break;
                            }
                        }
                        else
                            api.ui.holder.removeClass(c);
                    });
                });

            })();
            (function(){
                var jcrop_api;

                $('#jcrop-demo-tab .basic-handler img').Jcrop({
                    onChange:   showCoords,
                    onSelect:   showCoords,
                    onRelease:  clearCoords
                },function(){
                     jcrop_api = this;
                });

                $('#jcrop-demo-tab .basic-handler .coords').on('change','input',function(e){
                    var x1 = $('#x1').val(),
                        x2 = $('#x2').val(),
                        y1 = $('#y1').val(),
                        y2 = $('#y2').val();
                    jcrop_api.setSelect([x1,y1,x2,y2]);
                });

                // Simple event handler, called from onChange and onSelect
                // event handlers, as per the Jcrop invocation above
                function showCoords(c){
                    $('#x1').val(c.x);
                    $('#y1').val(c.y);
                    $('#x2').val(c.x2);
                    $('#y2').val(c.y2);
                    $('#w').val(c.w);
                    $('#h').val(c.h);
                };

                function clearCoords(){
                    $('#jcrop-demo-tab .basic-handler .coords').val('');
                };
            })();
            (function(){
                // Create variables (in this scope) to hold the API and image size
                var jcrop_api,
                    boundx,
                    boundy,

                    // Grab some information about the preview pane
                    $preview = $('#preview-pane'),
                    $pcnt = $('#preview-pane .preview-container'),
                    $pimg = $('#preview-pane .preview-container img'),

                    xsize = $pcnt.width(),
                    ysize = $pcnt.height();

                $('#jcrop-demo-tab .aspect-ratio .aspect-ratio-img').Jcrop({
                    onChange: updatePreview,
                    onSelect: updatePreview,
                    aspectRatio: xsize / ysize
                },function(){
                    // Use the API to get the real image size
                    var bounds = this.getBounds();
                    boundx = bounds[0];
                    boundy = bounds[1];
                    // Store the API in the jcrop_api variable
                    jcrop_api = this;

                    // Move the preview into the jcrop container for css positioning
                    $preview.appendTo(jcrop_api.ui.holder);
                });

                function updatePreview(c){
                    if (parseInt(c.w) > 0)
                    {
                        var rx = xsize / c.w;
                        var ry = ysize / c.h;

                        $pimg.css({
                            width: Math.round(rx * boundx) + 'px',
                            height: Math.round(ry * boundy) + 'px',
                            marginLeft: '-' + Math.round(rx * c.x) + 'px',
                            marginTop: '-' + Math.round(ry * c.y) + 'px'
                        });
                    }
                };
            })();
            (function(){
                
                var jcrop_api;

                $('#jcrop-demo-tab .animation-transitions .animation-transitions-img').Jcrop({
                    bgFade: true,
                    bgOpacity: .2,
                    setSelect: [60, 70, 540, 330]
                }, function () {
                    jcrop_api = this;
                });

                $('#fadetog').change(function () {
                    jcrop_api.setOptions({
                        bgFade: this.checked
                    });
                }).attr('checked', 'checked');

                $('#shadetog').change(function () {
                    if (this.checked)
                        $('#shadetxt').slideDown();
                    else
                        $('#shadetxt').slideUp();
                    jcrop_api.setOptions({
                        shade: this.checked
                    });
                }).attr('checked', false);

                // Define page sections
                var sections = {
                    bgc_buttons: 'Change bgColor',
                    bgo_buttons: 'Change bgOpacity',
                    anim_buttons: 'Animate Selection'
                };
                // Define animation buttons
                var ac = {
                    anim1: [217, 122, 382, 284],
                    anim2: [20, 20, 580, 380],
                    anim3: [24, 24, 176, 376],
                    anim4: [347, 165, 550, 355],
                    anim5: [136, 55, 472, 183]
                };
                // Define bgOpacity buttons
                var bgo = {
                    Low: .2,
                    Mid: .5,
                    High: .8,
                    Full: 1
                };
                // Define bgColor buttons
                var bgc = {
                    R: '#900',
                    B: '#4BB6F0',
                    Y: '#F0B207',
                    G: '#46B81C',
                    W: 'white',
                    K: 'black'
                };
                // Create fieldset targets for buttons
                for (i in sections)
                    insertSection(i, sections[i]);

                function create_btn(c) {
                    var $o = $('<button />').addClass('btn btn-small');
                    if (c)
                        $o.append(c);
                    return $o;
                }

                var a_count = 1;
                // Create animation buttons
                for (i in ac) {
                    $('#anim_buttons .btn-group')
                            .append(
                                    create_btn(a_count++).click(animHandler(ac[i])),
                                    ' '
                                    );
                }

                $('#anim_buttons .btn-group').append(
                        create_btn('Bye!').click(function (e) {
                    $(e.target).addClass('active');
                    jcrop_api.animateTo(
                            [300, 200, 300, 200],
                            function () {
                                this.release();
                                $(e.target).closest('.btn-group').find('.active').removeClass('active');
                            }
                    );
                    return false;
                })
                        );

                // Create bgOpacity buttons
                for (i in bgo) {
                    $('#bgo_buttons .btn-group').append(
                            create_btn(i).click(setoptHandler('bgOpacity', bgo[i])),
                            ' '
                            );
                }
                // Create bgColor buttons
                for (i in bgc) {
                    $('#bgc_buttons .btn-group').append(
                            create_btn(i).css({
                        background: bgc[i],
                        color: ((i == 'K') || (i == 'R')) ? 'white' : 'black'
                    }).click(setoptHandler('bgColor', bgc[i])), ' '
                            );
                }
                // Function to insert named sections into interface
                function insertSection(k, v) {
                    $('#interface')
                        .prepend(
                            $('<fieldset></fieldset>').attr('id', k)
                            .append($('<legend></legend>')
                                .append(v),
                                '<div class="btn-toolbar btn-toolbar-default"><div class="btn-group"></div></div>'
                            )
                        );
                }
                ;
                // Handler for option-setting buttons
                function setoptHandler(k, v) {
                    return function (e) {
                        $(e.target).closest('.btn-group').find('.active').removeClass('active');
                        $(e.target).addClass('active');
                        var opt = {};
                        opt[k] = v;
                        jcrop_api.setOptions(opt);
                        return false;
                    };
                }
                ;
                // Handler for animation buttons
                function animHandler(v) {
                    return function (e) {
                        $(e.target).closest('.btn-group').find('.active').removeClass('active');
                        $(e.target).addClass('active');
                        jcrop_api.animateTo(v, function () {
//                            $(e.target).closest('.btn-group').find('.active').removeClass('active');
                        });
                        return false;
                    };
                }
                ;

                $('#bgo_buttons .btn:first,#bgc_buttons .btn:last').addClass('active');
                $('#interface').show();

            })();
            (function(){
                
                // The variable jcrop_api will hold a reference to the
                // Jcrop API once Jcrop is instantiated.
                var jcrop_api;

                // In this example, since Jcrop may be attached or detached
                // at the whim of the user, I've wrapped the call into a function
                initJcrop();

                // The function is pretty simple
                function initJcrop()//{{{
                {
                    // Hide any interface elements that require Jcrop
                    // (This is for the local user interface portion.)
                    $('.requiresjcrop').hide();

                    // Invoke Jcrop in typical fashion
                    $('#jcrop-demo-tab .api-demo .api-img').Jcrop({
                        onRelease: releaseCheck
                    }, function () {

                        jcrop_api = this;
                        jcrop_api.animateTo([100, 100, 400, 300]);

                        // Setup and dipslay the interface for "enabled"
                        $('#can_click,#can_move,#can_size').attr('checked', 'checked');
                        $('#ar_lock,#size_lock,#bg_swap').attr('checked', false);
                        $('.requiresjcrop').show();

                    });

                }
                ;
                //}}}

                // Use the API to find cropping dimensions
                // Then generate a random selection
                // This function is used by setSelect and animateTo buttons
                // Mainly for demonstration purposes
                function getRandom() {
                    var dim = jcrop_api.getBounds();
                    return [
                        Math.round(Math.random() * dim[0]),
                        Math.round(Math.random() * dim[1]),
                        Math.round(Math.random() * dim[0]),
                        Math.round(Math.random() * dim[1])
                    ];
                }
                ;

                // This function is bound to the onRelease handler...
                // In certain circumstances (such as if you set minSize
                // and aspectRatio together), you can inadvertently lose
                // the selection. This callback re-enables creating selections
                // in such a case. Although the need to do this is based on a
                // buggy behavior, it's recommended that you in some way trap
                // the onRelease callback if you use allowSelect: false
                function releaseCheck()
                {
                    jcrop_api.setOptions({allowSelect: true});
                    $('#can_click').attr('checked', false);
                }
                ;

                // Attach interface buttons
                // This may appear to be a lot of code but it's simple stuff
                $('#setSelect').click(function (e) {
                    // Sets a random selection
                    jcrop_api.setSelect(getRandom());
                });
                $('#animateTo').click(function (e) {
                    // Animates to a random selection
                    jcrop_api.animateTo(getRandom());
                });
                $('#release').click(function (e) {
                    // Release method clears the selection
                    jcrop_api.release();
                });
                $('#disable').click(function (e) {
                    // Disable Jcrop instance
                    jcrop_api.disable();
                    // Update the interface to reflect disabled state
                    $('#enable').show();
                    $('.requiresjcrop').hide();
                });
                $('#enable').click(function (e) {
                    // Re-enable Jcrop instance
                    jcrop_api.enable();
                    // Update the interface to reflect enabled state
                    $('#enable').hide();
                    $('.requiresjcrop').show();
                });
                $('#rehook').click(function (e) {
                    // This button is visible when Jcrop has been destroyed
                    // It performs the re-attachment and updates the UI
                    $('#rehook,#enable').hide();
                    initJcrop();
                    $('#unhook,.requiresjcrop').show();
                    return false;
                });
                $('#unhook').click(function (e) {
                    // Destroy Jcrop widget, restore original state
                    jcrop_api.destroy();
                    // Update the interface to reflect un-attached state
                    $('#unhook, #enable,.requiresjcrop').hide();
                    $('#rehook').show();
                    return false;
                });

                // Hook up the three image-swapping buttons
                $('#img1').click(function (e) {
                    $(this).addClass('active').closest('.btn-group')
                            .find('button.active').not(this).removeClass('active');

                    jcrop_api.setImage('img/demo/8_680.jpg', function(){
                        this.setOptions({
                            bgOpacity: 0.5,
                            outerImage: 'img/demo/8_680.jpg'
                        });
                        this.animateTo(getRandom());
                    });
                    jcrop_api.setOptions({bgOpacity: .6});
                    return false;
                });
                $('#img2').click(function (e) {
                    $(this).addClass('active').closest('.btn-group')
                            .find('button.active').not(this).removeClass('active');

                    jcrop_api.setImage('img/demo/9_680.jpg', function(){
                        this.setOptions({
                            bgOpacity: 0.5,
                            outerImage: 'img/demo/9_680.jpg'
                        });
                        this.animateTo(getRandom());
                    });
                    jcrop_api.setOptions({bgOpacity: .6});
                    return false;
                });
                $('#img3').click(function (e) {
                    $(this).addClass('active').closest('.btn-group')
                            .find('button.active').not(this).removeClass('active');

                    jcrop_api.setImage('img/demo/10_680.jpg', function () {
                        this.setOptions({
                            bgOpacity: 0.5,
                            outerImage: 'img/demo/10_680.jpg'
                        });
                        this.animateTo(getRandom());
                    });
                    return false;
                });

                // The checkboxes simply set options based on it's checked value
                // Options are changed by passing a new options object

                // Also, to prevent strange behavior, they are initially checked
                // This matches the default initial state of Jcrop

                $('#can_click').change(function (e) {
                    jcrop_api.setOptions({allowSelect: !!this.checked});
                    jcrop_api.focus();
                });
                $('#can_move').change(function (e) {
                    jcrop_api.setOptions({allowMove: !!this.checked});
                    jcrop_api.focus();
                });
                $('#can_size').change(function (e) {
                    jcrop_api.setOptions({allowResize: !!this.checked});
                    jcrop_api.focus();
                });
                $('#ar_lock').change(function (e) {
                    jcrop_api.setOptions(this.checked ?
                            {aspectRatio: 4 / 3} : {aspectRatio: 0});
                    jcrop_api.focus();
                });
                $('#size_lock').change(function (e) {
                    jcrop_api.setOptions(this.checked ? {
                        minSize: [80, 80],
                        maxSize: [350, 350]
                    } : {
                        minSize: [0, 0],
                        maxSize: [0, 0]
                    });
                    jcrop_api.focus();
                });

            })();
        };
    </script>
</div>